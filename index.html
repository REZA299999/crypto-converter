<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CryptoXchanger - Dark Mode</title>
  <meta name="description" content="Converter crypto interaktif real-time dengan tema gelap. Dukungan BTC, ETH, LTC, SOL, USDT, dan lainnya.">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 30px 20px;
    }
    h1 {
      text-align: center;
      color: #00ffcc;
    }
    label {
      margin-top: 20px;
      display: block;
    }
    .crypto-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    select, input {
      flex: 1;
      padding: 10px;
      border-radius: 5px;
      border: none;
      background: #1e1e1e;
      color: #fff;
    }
    .crypto-icon {
      width: 28px;
      height: 28px;
    }
    #result {
      margin-top: 25px;
      font-size: 1.3rem;
      text-align: center;
      color: #00e6a8;
    }
    canvas {
      margin-top: 40px;
      background: #1e1e1e;
      padding: 15px;
      border-radius: 10px;
    }
    footer {
      text-align: center;
      margin-top: 50px;
      font-size: 0.85rem;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>ðŸ’± CryptoXchanger</h1>
  <p style="text-align: center;">Konversi crypto populer secara real-time</p>

  <label>Dari:</label>
  <div class="crypto-row">
    <img id="fromIcon" class="crypto-icon" src="" alt="icon" />
    <select id="from"></select>
  </div>

  <label>Ke:</label>
  <div class="crypto-row">
    <img id="toIcon" class="crypto-icon" src="" alt="icon" />
    <select id="to"></select>
  </div>

  <label>Jumlah:</label>
  <input type="number" id="amount" value="1" min="0" step="any" />

  <div id="result">Masukkan jumlah untuk melihat hasil...</div>

  <canvas id="priceChart" width="600" height="300"></canvas>

  <footer>&copy; 2025 CryptoXchanger. Real-time crypto converter.</footer>

  <script>
    const cryptos = {
      bitcoin: "Bitcoin (BTC)",
      ethereum: "Ethereum (ETH)",
      litecoin: "Litecoin (LTC)",
      solana: "Solana (SOL)",
      tether: "Tether (USDT)",
      polygon: "Polygon (MATIC)",
      binancecoin: "BNB (BNB)",
      arbitrum: "Arbitrum (ARB)",
      avalanche-2: "Avalanche (AVAX)",
      optimism: "Optimism (OP)",
      base: "Base (BASE)"
    };

    const iconMap = {
      bitcoin: "https://assets.coingecko.com/coins/images/1/small/bitcoin.png",
      ethereum: "https://assets.coingecko.com/coins/images/279/small/ethereum.png",
      litecoin: "https://assets.coingecko.com/coins/images/2/small/litecoin.png",
      solana: "https://assets.coingecko.com/coins/images/4128/small/Solana.png",
      tether: "https://assets.coingecko.com/coins/images/325/small/Tether-logo.png",
      polygon: "https://assets.coingecko.com/coins/images/4713/small/matic-token-icon.png",
      binancecoin: "https://assets.coingecko.com/coins/images/825/small/bnb-icon.png",
      arbitrum: "https://assets.coingecko.com/coins/images/16547/small/photo_2023-03-27_14-14-01.jpg",
      avalanche-2: "https://assets.coingecko.com/coins/images/12559/small/coin-round-red.png",
      optimism: "https://assets.coingecko.com/coins/images/25244/small/OP.jpeg",
      base: "https://via.placeholder.com/28?text=B" // Placeholder karena belum resmi
    };

    const fromSelect = document.getElementById('from');
    const toSelect = document.getElementById('to');
    const amount = document.getElementById('amount');
    const result = document.getElementById('result');
    const fromIcon = document.getElementById('fromIcon');
    const toIcon = document.getElementById('toIcon');

    fromIcon.onerror = () => fromIcon.src = 'https://via.placeholder.com/28';
    toIcon.onerror = () => toIcon.src = 'https://via.placeholder.com/28';

    let chart;

    function populateSelects() {
      for (const id in cryptos) {
        const optionFrom = new Option(cryptos[id], id);
        const optionTo = new Option(cryptos[id], id);
        fromSelect.appendChild(optionFrom);
        toSelect.appendChild(optionTo);
      }
      fromSelect.value = "bitcoin";
      toSelect.value = "ethereum";
    }

    function updateIcons() {
      fromIcon.src = iconMap[fromSelect.value];
      toIcon.src = iconMap[toSelect.value];
    }

    async function updateResult() {
      const fromVal = fromSelect.value;
      const toVal = toSelect.value;
      const amt = parseFloat(amount.value);

      updateIcons();

      if (fromVal === toVal || isNaN(amt) || amt <= 0) {
        result.textContent = 'Silakan pilih koin berbeda dan jumlah valid.';
        return;
      }

      result.textContent = 'Mengambil data...';

      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${fromVal},${toVal}&vs_currencies=usd`);
        const data = await res.json();
        const fromUSD = data[fromVal]?.usd;
        const toUSD = data[toVal]?.usd;

        if (!fromUSD || !toUSD) throw new Error("Invalid price data");

        const converted = (amt * fromUSD) / toUSD;
        result.textContent = `${amt} ${fromVal.toUpperCase()} â‰ˆ ${converted.toFixed(6)} ${toVal.toUpperCase()}`;
      } catch {
        result.textContent = 'Gagal mengambil data.';
      }
    }

    async function drawChart() {
      const coin = fromSelect.value;
      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coin}/market_chart?vs_currency=usd&days=1`);
        const data = await res.json();

        const labels = data.prices.map(p => {
          const date = new Date(p[0]);
          return date.getHours() + ':' + ('0' + date.getMinutes()).slice(-2);
        });
        const prices = data.prices.map(p => p[1]);

        const ctx = document.getElementById('priceChart').getContext('2d');
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: `Harga ${coin.toUpperCase()} (USD) - 24 Jam`,
              data: prices,
              borderColor: '#00ffcc',
              backgroundColor: 'rgba(0, 255, 204, 0.1)',
              tension: 0.25,
              fill: true,
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { labels: { color: 'white' } }
            },
            scales: {
              x: { ticks: { color: 'white' } },
              y: { ticks: { color: 'white' } }
            }
          }
        });

      } catch (err) {
        console.error('Gagal ambil grafik:', err);
      }
    }

    // Inisialisasi awal
    populateSelects();
    updateIcons();
    updateResult();
    drawChart();

    fromSelect.addEventListener('change', () => {
      updateResult();
      drawChart();
    });
    toSelect.addEventListener('change', updateResult);
    amount.addEventListener('input', updateResult);
  </script>
</body>
</html>
