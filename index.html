<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CryptoXchanger - Konversi Crypto Real-Time</title>
  <meta name="description" content="Konversi cryptocurrency populer secara real-time dan lihat grafik tren harga mini. Gratis, cepat, dan mudah." />
  <meta name="keywords" content="crypto converter, konversi crypto, bitcoin to ethereum, btc ke usdt, crypto realtime, exchange crypto" />
  <meta name="author" content="CryptoXchanger" />
  <meta name="robots" content="index, follow" />
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #00f7c4;
    }
    select, input {
      padding: 10px;
      margin: 10px;
      background-color: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
    }
    img.icon {
      width: 24px;
      vertical-align: middle;
      margin-right: 5px;
    }
    .chart-container {
      width: 120px;
      height: 60px;
      display: inline-block;
      margin: 10px;
      background: #1b1b1b;
      border-radius: 8px;
      padding: 6px;
    }
    .coin-symbol {
      font-size: 12px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h1>ðŸ’± <span style="color: #00f7c4">CryptoXchanger</span></h1>
  <p>Konversi crypto populer secara real-time</p>

  <div>
    <label>Dari:<br>
      <img id="iconFrom" class="icon" src="" alt="icon">
      <select id="fromCurrency"></select>
    </label>
  </div>

  <div>
    <label>Ke:<br>
      <img id="iconTo" class="icon" src="" alt="icon">
      <select id="toCurrency"></select>
    </label>
  </div>

  <div>
    <label>Jumlah:<br>
      <input type="number" id="amount" value="1" min="0">
    </label>
  </div>

  <h2 id="result">Masukkan jumlah untuk melihat hasil...</h2>

  <h3 style="margin-top:40px;">ðŸ“‰ Grafik Tren Harga (Update Real-Time)</h3>
  <div id="charts"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const supportedCoins = [
      { id: "bitcoin", symbol: "BTC" },
      { id: "ethereum", symbol: "ETH" },
      { id: "litecoin", symbol: "LTC" },
      { id: "solana", symbol: "SOL" },
      { id: "tether", symbol: "USDT" },
      { id: "polygon", symbol: "MATIC" },
      { id: "binancecoin", symbol: "BNB" },
      { id: "arbitrum", symbol: "ARB" },
      { id: "optimism", symbol: "OP" },
      { id: "base", symbol: "BASE" }
    ];

    const iconMap = {};
    supportedCoins.forEach(c => {
      iconMap[c.id] = `https://crypto-icons.pages.dev/icons/${c.symbol.toLowerCase()}.svg`;
    });

    const fromSelect = document.getElementById("fromCurrency");
    const toSelect = document.getElementById("toCurrency");
    const iconFrom = document.getElementById("iconFrom");
    const iconTo = document.getElementById("iconTo");
    const amountInput = document.getElementById("amount");
    const resultText = document.getElementById("result");
    const chartsDiv = document.getElementById("charts");

    function populateSelects() {
      supportedCoins.forEach(coin => {
        const optionFrom = document.createElement("option");
        optionFrom.value = coin.id;
        optionFrom.textContent = coin.symbol;
        fromSelect.appendChild(optionFrom);

        const optionTo = document.createElement("option");
        optionTo.value = coin.id;
        optionTo.textContent = coin.symbol;
        toSelect.appendChild(optionTo);
      });

      fromSelect.value = "bitcoin";
      toSelect.value = "ethereum";
      updateIcons();
    }

    function updateIcons() {
      iconFrom.src = iconMap[fromSelect.value];
      iconTo.src = iconMap[toSelect.value];
    }

    async function convert() {
      const from = fromSelect.value;
      const to = toSelect.value;
      const amount = parseFloat(amountInput.value);

      if (!amount || amount <= 0) {
        resultText.textContent = "Masukkan jumlah valid...";
        return;
      }

      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${from}&vs_currencies=${to}`);
        const data = await res.json();
        const rate = data[from][to];
        const converted = rate * amount;
        resultText.textContent = `${amount} ${from.toUpperCase()} â‰ˆ ${converted.toFixed(6)} ${to.toUpperCase()}`;
      } catch (err) {
        resultText.textContent = "Gagal mengambil data.";
      }
    }

    let chartInstances = {};
    let chartData = {};

    async function updateChartRealTime(coin) {
      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coin.id}&vs_currencies=usd`);
        const data = await res.json();
        const price = data[coin.id].usd;

        if (!chartData[coin.id]) chartData[coin.id] = [];
        chartData[coin.id].push(price);

        if (chartData[coin.id].length > 60) chartData[coin.id].shift();

        const chart = chartInstances[coin.id];
        if (chart) {
          chart.data.labels.push(new Date().toLocaleTimeString());
          chart.data.datasets[0].data.push(price);

          if (chart.data.labels.length > 60) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        }
      } catch (e) {
        console.log(`Gagal update chart ${coin.id}`);
      }
    }

    async function fetchAndDrawCharts() {
      chartsDiv.innerHTML = "";
      chartInstances = {};
      chartData = {};

      for (const coin of supportedCoins) {
        const container = document.createElement("div");
        container.className = "chart-container";

        const canvas = document.createElement("canvas");
        canvas.id = `chart-${coin.id}`;
        container.appendChild(canvas);

        const symbolLabel = document.createElement("div");
        symbolLabel.className = "coin-symbol";
        symbolLabel.textContent = coin.symbol;
        container.appendChild(symbolLabel);

        chartsDiv.appendChild(container);

        try {
          const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coin.id}/market_chart?vs_currency=usd&days=7&interval=daily`);
          const data = await res.json();
          const prices = data.prices.map(p => p[1]);
          const labels = prices.map((_, i) => `Hari ${i + 1}`);
          chartData[coin.id] = prices.slice();

          chartInstances[coin.id] = new Chart(canvas.getContext("2d"), {
            type: "line",
            data: {
              labels: labels,
              datasets: [{
                data: prices,
                borderColor: "#00f7c4",
                borderWidth: 1.5,
                fill: false,
                pointRadius: 0,
                tension: 0.3
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { display: false },
                y: { display: false }
              },
              plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
              }
            }
          });

          setInterval(() => updateChartRealTime(coin), 60000);
        } catch {
          const errorText = document.createElement("div");
          errorText.style.color = "#f55";
          errorText.style.fontSize = "10px";
          errorText.textContent = "Gagal muat grafik";
          container.appendChild(errorText);
        }
      }
    }

    populateSelects();
    convert();
    fetchAndDrawCharts();

    fromSelect.addEventListener("change", () => { updateIcons(); convert(); });
    toSelect.addEventListener("change", () => { updateIcons(); convert(); });
    amountInput.addEventListener("input", convert);
  </script>
</body>
</html>
